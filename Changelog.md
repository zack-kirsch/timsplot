# Changelog

## 2025.04.22
- General
 - added a button to most of the plotting pages that gives descriptions/notes for the given plot as a popover
- File Import
 - changed layout of main page, added instruction popovers instead of walls of text on the page
 - added support for most quantitative and qualitative BPS output
 - adjusted filtering options for DIANN imports, changed to radio buttons so no filtering can be an option
 - added a filter on the last lines of the file import to get rid of contaminant and decoy sequences
 - added error handling so that the app doesn't need to be restarted when the metadata table hasn't been filled out and the Apply Changes button is pressed (condition switch on or off)
 - changed how PTMs are interpreted, calling dictionaries with keys and values to replace in the search file instead of specifically making a dict for each software
 - added extra handling for BPS files where protein groups that start with a semicolon and have a missing protein name are filled in (noted for pulsar, rescore, and spectronaut)
 - added an option to filter protein list using the cRAP database
- Settings
 - adjusted how color rectangles are shown in the conditions table, removed need for extra variable box that didn't need to be edited anyway
 - added PTM settings tab
- Metrics
 - Peptide Length
   - adjusted so y axes are on the same scale for subplots
 - Dynamic Range
   - added an extra filter for when there are zeros in the PG.MS2Quantity that cause the dynamic range to be shown as inf
- PTMs
 - added a text popup to show all PTMs that were detected
 - CV Plots
   - added handling for when there's only one condition
- Heatmaps
 - Histogram
   - fixed handling of zeroes with FG and PG MS2Quantity columns that would result in an error with histogram bounds
- Statistics
 - Dendrogram/Protein Signal
   - added section to show linkage of runs and heatmap of protein signal
- Immunopeptidomics
 - Charge State per Peptide Length
   - adjusted so y axes are on the same scale for subplots
- Mixed Proteome
 - adjusted how organism names are detected (using just first entry in protein groups that contain semicolons)
 - added Remove column to the info setup to allow for removing unwanted rows from further use in the plotting functions
 - adjusted how organism names can be removed from downstream plotting functions
 - Counts per Organism
   - added a bar width slider 
 - Quant Ratios
   - changed how values are interpreted from the input table (initially interpreted as int, changed to float)
- De Novo
 - adjusted file import to mirror main file import
- Two Software Comparison
 - adjusted file import to mirror main file import
- MOMA
 - added custom error message for when there are no MOMA events detected
- Export Tables
 - added error messages / error handling for downloadable tables

## 2025.04.01
- ID Counts
  - added Tracker section, where intensities of selected protein or peptides for a selected protein can be plotted
  - UpSet Plot
    - added an option to show plot for just a selected condition instead of every condition/replicate in the search report
    - added options to show just counts that are found in a single run or all but one run
    - added Precursor as an option to plot
  - UpSet Plot (stats)
    - added section to compare IM/mz of uniquely identified peptides/precursors
- Metrics
  - Charge State
    - added an option for plotting as stacked bar chart
  - Missed Cleavages
    - added a slider to adjust bar width
  - Data Completeness
    - added option for stripped/modified peptides instead of just specifying peptides (it was originally stripped sequences), to be more in line with what the UpSet plot shows
- PTMs
  - PTMs per Precursor
    - adjusted how bar graph is shown, the indices were being shown out of order and would lead to misinterpretations of the numbers of ptms for the x axis
- Heatmaps
  - RT, m/z, IM Heatmaps
    - fixed a bug where zeroes in the first value of the intensity column caused the BPC to be removed when intensities were nonzero
    - added different heatmap color options
  - Charge/PTM Precursor Heatmap
    - added an option to download a template for the DIA windows
    - added different heatmap color options
  - Venn Diagram
    - added option to specify PTM to compare across runs
  - Histogram
    - added section for plotting histogram of precursor/protein intensities or ion mobility values from IDs
- Immunopeptidomics
  - Charge States (Stacked)
    - fixed how coloring works for the bar graphs so that they all start from the same place
    - legend will be based on the last-plotted bar so if dfs have different lengths the colors for the last few charge states (least populated) might not be accurate
- PRM
  - added an option to download a template for the PRM table
- MOMA
  - added section to extract possible MOMA events and generate EIMs
- De Novo
  - Compare - Stripped Peptide IDs
    - fixed a bug with picking specific peptide length to compare
- Two-Software Comparison
  - Venn Diagram
    - adjusted setup similarly to changes for Venn under Heatmaps section
- Export Tables
  - changed MOMA RT tolerance to seconds instead of %
- Raw Data
  - changed how EIC and EIM import raw data files, no more need to reload raw file each EIC/EIM 

## 2025.03.05
- General
  - added some handling for when zeros are present in the MS2Quantity columns for CV calculations (regular and PTM CV calculations)
- File Import
  - adjusted DIA-NN 2.0 import to account for PG.MS2Quantity
- Settings
  - File Stats
    - changed how maxreplicatelist is calculated so it captures the number of replicates per condition more reasonably (length of replicate list instead of taking max value)
- ID Counts
  - added peptide-level CVs to CV violin plot and CVs below cutoff plot with a switch to change the grouping key in the settings tab (this was also added to the PTM tab)
- Metrics
  - added Missed Cleavages bar plot
- Statistics
  - added Feature Plot section to track protein abundance for selected proteins
- Mixed Proteome
  - Quant Ratios
    - adjusted how quant ratios are calculated to accommodate conditions with only a single replicate

## 2025.02.28
- added some instructions in the file import tab
- File Import
  - switched the filtering for DIANN MBR, it was the opposite of what it should have been
  - added support for DIA-NN 2.0 parquet files in main file import, de novo comparison, and two-software comparison
- Settings
  - added a line to both color table images to make sure that the original working directory is used to pull the images file
  - specific case where going to raw data first and then going to Settings tab had an error since the code was looking for the images files in the directory where the raw data was taken from
- Heatmaps
  - added an option to use stripped peptides in Venn Diagram and an option to remove terminal AAs from the comparison
- Immunopeptidomics
  - added sequence motifs plot using logomaker Python package
- Mixed Proteome
  - added handling for when one condition only has a single replicate
  - added an option to change axis scaling for quant ratios plot
- Glycoproteomics
  - added support for Glycoscape
  - added Venn diagram to compare glycoprotein, glycopeptide, and glycoPSM IDs
- De Novo
  - added tab for comparing sequence motifs from BPS Novor and secondary software
  - added switch to only use unique BPS novor IDs in sequence motifs plot
  - fixed an issue with file import and converting the stripped peptide sequence to the modified sequence where blank values for the ptm locations were causing an error
  - added a switch for the stripped peptide comparison to only do the comparison between the sequences with the first and last 2 residues cut off
- Export Tables
  - added a slider for an IM difference tolerance to avoid MOMA events with very similar IM
- Two-Software Comparison
  - added tab for comparing results from two different search software


## 2025.01.21
- General
  - split library import into two sections. First just to call the necessary libraries to open the app and the rest closer to the server code, this should make the app launch faster
  - adjusted slider range for plot width/height and added sliders for all plots in the app
  - added functionality for BPS Novor results
- File Import
  - added a switch for DIANN import to filter Q values based on whether or not MBR was used in the search
- Settings
  - added a switch to change the DPI to 300 for publication-quality figures, conditional for this put under the variables_dfs function. Changing the switch makes a direct change, no need for a button or anything
- Metrics
  - added an option to plot Data Completeness by condition instead of just grouping all runs in the search file together
- Metrics/PTM
  - adjusted how the mass accuracy histograms are put together, fixed handling of multiple runs
- Heatmaps
  - changed logic for Venn diagrams to make it simpler, added capability for 3-sided comparison and comparison of peptides and precursors of specified lengths
  - added Bremen DIA windows for Charge/PTM Precursor Heatmap
- Statistics
  - added up/down regulated proteins bar plot to show highest -log10 pvalues that fall above the fold change cutoff
- De Novo
  - added section and new plot capabilities for BPS Novor data
  - added ability to compare BPS Novor with secondary software with individual upload page for the secondary
- Raw Data
  - added axis labels, axis label font sizes, minor ticks, plot titles to all plots
- Export Tables
  - for protein and precursor tables, made sure to include the condition and protein/precursor information that wasn't being added as a result of being used as the index to the table

## 2024.12.12
- General
  - added descriptions for some plotting sections to help clarify what's happening under the hood
- File Import
  - updated reminder text for each search software
  - modified file import to include multiple files in upload
  - modified inputfile() function that if there are more than 1 file uploaded, concatenate them row-wise before moving on to column rename/drop
    - the function first checks if the first file uploaded is a .tsv to keep with differentiating BPS vs other software output
  - added a line in the fragger file input that calculates mass accuracy and adds it as a column to the search report
  - added handling for tims-DIANN and tims-rescore data from BPS, can only import one .zip file at a time for now
  - adjusted visual of the file import window
- Metrics
  - added a calculation of peak widths to its own function, redid how the calculation is put together (more similarly to how CVs are calculated and tabulated for plotting)
  - added a table of mean and median peak widths
  - added an option to show all peak widths or remove outlier 5% peak widths from violin plot
  - added error handling for charge state, pep length, and peps per protein where the plotting color was being unnecessarily split when there was only one condition present (but with replicates)
  - added a slider to Peptides per Protein to explicitly set the high end of the x axis range
  - changed how the marker is shown in Peptide Lengths to avoid confusion because of the comma previously used
  - added minor x ticks to the Peptide Lengths bar plots
  - added Mass Accuracy plot (violin or histogram options)
- PTMs
  - moved CV calculation to its own function to avoid redundancy in plotting and generating table
  - added a table like for ID Counts CV plot
  - added the same mass accuracy plotting from the Metrics section to just precursors with a specified PTM
- Heatmaps
  - changed how charge/ptm scatter is plotted
  - added a table to charge/ptm scatter to show the number of precursors of each charge state present in the scatter depending on the selection
- Statistics
  - fixed an issue where the label size for the volcano plot wasn't set to the input variable
- Immunopeptidomics
  - added section
  - added different modes of charge state plotting requested by Kristina Marx which specifies peptides that are detected at multiple charge states instead of lumping them together
  - included for two of the plotting modes the ability to only plot specific charges of interest
- Mixed Proteome
  - adjusted peptide count for each organism to match how ID counts are done (unique values from EG.ModifiedPeptide)
  - added a data table to the Quant Ratios plot
  - added an option to use mean or median quant values for calculating Quant Ratios
- Dilution Series
  - moved calculations to make the plot into a separate function so that changing the plot size with the sliders doesn't need re-execution of the calcuation
- Raw Data
  - added an option to paste a directory containing raw data files instead of individually pasting the whole file path for each raw file

- File Import
  - fixed an issue with DIA-NN input where the filenames weren't sorted (as assumed from other software) and ended up duplicating condition and replicate values across each file name. Fixed by adding a sort_values before returning searchoutput df
- ID Counts
  - fixed an issue with CV plotting where it would error out when there was only one sample condition

## 2024.11.15
- General
  - adjusted width and height slider ranges
  - *important* changed ProteinNames to ProteinGroups in calculations throughout, that way all calculations are based on PG.ProteinGroups (except for mixed proteome which needs PG.ProteinNames)
  - added an option in Setitngs for rotating the x labels on most plots (especially those that have condition names as the x labels)
- File Import
  - adjusted how fragger glyco input is handled in case the Spectrum File column has no distinct values
- ID Counts
  - added an option in UpSet Plot to plot by condition or by run instead of just by run
  - changed "Peptides" title to "Modified Peptides"
  - added a table to the CV Plots that shows the mean and median CV values that updates based on selections for precursor/protein and 5% outlier cutoff
- Metrics
  - changed the top N slider for dynamic range to int values instead of float
  - added an option in Peptide Length to hide the length marker
  - changed rotation of charge state labels to 90 deg that way they don't overlap
  - adjusted the calculation behind charge states function, was using stripped sequence instead of modified sequence and was ultimately under-counting the number of precursors 
- PTMs
  - fixed an error with fragpipe data where Acetyl modifications were not being renamed correctly
  - removed PTM enrichment tab and changed how PTM ID counts are plotted similarly to the glycoproteomics ID counts enrichment
    - Radio button to switch between ID counts and % of total IDs per run (enrichment)
- Heatmaps
  - added an option in Venn Diagram to plot by condition or by run instead of just by run
  - added an option in Venn Diagram to download the list of IDs that are shown in the Venn diagram
  - added an option in Charge/PTM Precursor Scatter to choose to plot based on Cond_Rep
  - added an option in IDs vs RT to choose runs from a checklist
- PCA
  - adjusted PC bar graph to just show first 3 components
  - added volcano plot calculation and plotting
- Mixed Proteome
  - complete overhaul of how the calculations were performed. Added a table in the Info tab to simplify input
  - everything back to previous working condition but with new logic for the calculations
- PRM
  - adjusted how intensity across runs is plotted such that the x axis order is what we'd expect. Missing values are added as zeros
  - changed plotting setup for individual peptide tracker. Plots should be generated a lot more cleanly and if signal is missing for the lowest concentration, we set all values of measured ratio to 0
- Dilution Series
  - added a theoretical ratio line to the plot
- Export Tables
  - added index=False to the .to_csv for each function to get rid of unnecessary index column in the output .csv
  - added an option to export a list of stripped peptide sequences of specific length (specifically for use in weblogo)
- Glycoproteomics
  - added Total Glycan Composition to the glycopeptide df that's used in the dictionary and df generation
  - changed language in Glycan Tracker to % of IDs instead of enrichment
  - simplified the two functions (glyco_variables, glyco_dataframes) since the dictionaries generated by glyco_variables weren't being used except to generate the dataframes

## 2024.10.28
- File Import
  - added the capability to download the metadata table as-shown as well as upload your own metadata table
  - added error handling for different software search reports. If columns are missing, it will ignore them in the .drop function
- PTMs
  - adjusted ptmcounts function, no need for MS2Quantity columns and made it more comparable to the idmetrics function
- Glycoproteomics
  - added section, working on adding different visualization functions
- reordered some side tabs

## 2024.10.21
- metadata
  - changed how metadata works. Added 2nd table that only shows conditions so it makes reordering and concentration input much easier
  - it should update with removal of entire conditions' replicates in the replicate-based metadata table so long as the switch is active
  - changed how R.Condition, R.Replicate, and concentration are updated from the metadata, substantially faster by not going row-by-row 
- throughout 
  - changed .str.contains(condition) to ==condition. There was a bug where - in the condition name would make the code interpret as an invalid decimal and mess up how it interpreted the conditions
  - adjusted titlefont, axisfont, labelfont, and legendfont throughout such that changing the sliders in the control panel adjusts the right groupings
- idmetrics
  - added a sort for resultdf so that the conditions are ordered when it's generated. There was a bug where the ordering for the conditions would be correct based on the metadata (as in the x axis labels) in the idmetrics plot but the actual data were in order of condition because of the way the loop works
- Settings
  - Control Panel 
    - tab added for font size control and other plotting customization
    - new variables to add throughout in plotting functions
      - titlefont=input.titlefont()
      - axisfont=input.axisfont()
      - labelfont=input.labelfont()
      - legendfont=input.legendfont()
      - ypadding=input.ypadding()
  - Column Check 
    - tab added to make sure necessary columns are present
  - Color Settings
    - changed the matplotlib and css color groups to images that were explicitly saved to \images under the Spectronaut_Vis_App folder
    - this makes them load faster and stay present even when the tab is reloaded
    - the functions are still present to render them as plots under
  - File Stats
    - added panel with useful information about the input file
- Metrics
  - added separate functions for explicitly calculating metrics instead of using the idmetrics function. Should help in error handling
  - Peptide Lengths
    - adjusted x axis such that it always uses integer ticks for the x axis
  - Peptides per Protein  
    - adjusted plotting such that there is a hard cutoff to the high x range
    - adjusted plotting such that values were sorted properly, preventing odd plotting artefacts
  - Data Completeness
    - adjusted y padding and spacing for data labels
  - Added Peak Width section
- PTMs
  - PTMs per Precursor
    - adjusted ylim top and x axis tick position
- Heatmaps
  - RT, m/z, IM Heatmaps
    - adjusted single replicate choice to == instead of .str.contains
  - Charge/PTM Precursor Heatmap 
    - adjusted syntax in uploading custom dia windows
  - IDs vs RT
    - adjusted rtmax to just the nearest whole number instead of the nearest ten
  - Venn Diagram of IDs    
    - adjusted single replicate choice to == instead of .str.contains
  - Charge/PTM Scatter
    - added as a plotting option, shows precursors of picked charge or ptm against all the other precursors to show how charges/ptms group in the heatmap
- Mixed Proteome
  - Counts per Organism
    - Added options for plotting peptides and precursors per organism instead of just proteins
- Raw Data
  - Added EIM section
- Added Dilution Series section
- Added PCA section    
